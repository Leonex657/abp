import flet as ft

def main(page: ft.Page):
    page.title = "Proyecto ABP"
    page.window_width = 520
    page.window_height = 720

    titulo = ft.Text("CPU", size=22, weight="bold")
    texto = ft.Text("", size=18)
    imagen = ft.Image(src="", width=280, height=180, fit=ft.ImageFit.CONTAIN, visible=False)
    btn_reset = ft.ElevatedButton("Reiniciar", icon=ft.Icons.REFRESH, visible=False)

    preguntas = [
        {
            "texto": "¬øCu√°l es la funci√≥n principal de la ALU dentro de un microprocesador?",
            "opciones": [
                ("a) Gestionar la memoria", False),
                ("b) Ejecutar operaciones aritm√©ticas y l√≥gicas", True),
                ("c) Coordinar los registros internos", False),
                ("d) Coordinar los registros internos", False),
            ]
        },
        {
            "texto": "¬øLa ALU se encuentra contenida dentro de qu√© otro componente m√°s general?",
            "opciones": [
                ("a) GPU", False),
                ("b) Unidad de Control", False),
                ("c) Memoria RAM", False),
                ("d) CPU", True),
            ]
        },
        {
            "texto": "¬øCu√°l es la responsabilidad principal de la Unidad de Control?",
            "opciones": [
                ("a) Realizar c√°lculos aritm√©ticos", False),
                ("b) Almacenar datos temporalmente", False),
                ("c) Coordinar la ejecuci√≥n correcta de instrucciones", True),
                ("d) Dibujar gr√°ficos en pantalla", False),
            ]
        },
        {
            "texto": "¬øQu√© otro componente siempre trabaja en conjunto con la Unidad de Control dentro de la CPU?",
            "opciones": [
                ("a) Disco duro", False),
                ("b) ALU", True),
                ("c) ROM", False),
                ("d) Tarjeta de red", False),
            ]
        },
        {
            "texto": "¬øQu√© tipo de informaci√≥n almacenan los registros?",
            "opciones": [
                ("a) Informaci√≥n visual", False),
                ("b) Informaci√≥n temporal durante la ejecuci√≥n de instrucciones", True),
                ("c) Configuraciones de hardware", False),
                ("d) Datos almacenados permanentemente", False),
            ]
        },
        {
            "texto": "¬øD√≥nde se encuentran f√≠sicamente los registros?",
            "opciones": [
                ("a) En la memoria RAM externa", False),
                ("b) Dentro del disco duro", False),
                ("c) Dentro de la CPU", True),
                ("d) En la tarjeta gr√°fica", False),
            ]
        },
        {
            "texto": "¬øQu√© muestra el diagrama completo presentado al final del programa?",
            "opciones": [
                ("a) C√≥mo la GPU procesa im√°genes", False),
                ("b) C√≥mo los dispositivos de entrada y salida se conectan al CPU", False),
                ("c) C√≥mo la CPU interact√∫a con memoria, entrada/salida y realiza procesamiento", True),
                ("d) C√≥mo se programan videojuegos", False),
            ]
        },
        {
            "texto": "¬øQui√©n coordina todas las operaciones dentro del CPU seg√∫n el diagrama?",
            "opciones": [
                ("a) La memoria RAM", False),
                ("b) Los registros", False),
                ("c) La Unidad de Control", True),
                ("d) El mouse y el teclado", False),
            ]
        },
    ]

    indice_actual = {"valor": -1}
    botones_opciones = []

    def ocultar_todos_los_botones():
        for b in botones_opciones:
            b.visible = False
            b.on_click = None
        btn_reset.visible = True

    def mostrar_pregunta(indice):
        if indice >= len(preguntas):
            final_bueno()
            return

        pregunta = preguntas[indice]
        texto.value = pregunta["texto"]
        ocultar_todos_los_botones()

        for i, (opcion_texto, es_correcta) in enumerate(pregunta["opciones"]):
            b = botones_opciones[i]
            b.text = opcion_texto
            b.visible = True
            b.on_click = on_correcta if es_correcta else on_incorrecta

        page.update()

    def comenzar_quiz(e):
        indice_actual["valor"] = 0
        mostrar_pregunta(indice_actual["valor"])

    def on_correcta(e):
        indice_actual["valor"] += 1
        mostrar_pregunta(indice_actual["valor"])

    def on_incorrecta(e):
        final_malo()

    def final_bueno():
        texto.value = "üèÜüéâ ¬°Felicidades, completaste el quiz exitosamente!"
        page.bgcolor = ft.Colors.GREEN
        ocultar_todos_los_botones()
        btn_reset.visible = True
        page.update()

    def final_malo():
        texto.value = "üíÄ‚ò†Ô∏è Has fallado el quiz. Estudia m√°s."
        page.bgcolor = ft.Colors.RED
        ocultar_todos_los_botones()
        btn_reset.visible = True
        page.update()

    def on_reset(e):
        page.bgcolor = None
        indice_actual["valor"] = -1
        texto.value = "¬øEst√°s listo para comenzar el quiz sobre la CPU?"
        ocultar_todos_los_botones()
        btn_comenzar.visible = True
        page.update()

    # Crear botones (m√°ximo 4 opciones por pregunta)
    for _ in range(4):
        btn = ft.ElevatedButton("Opci√≥n", visible=False)
        botones_opciones.append(btn)

    btn_comenzar = ft.ElevatedButton("Comenzar Quiz", on_click=comenzar_quiz)
    btn_reset.on_click = on_reset

    page.add(
        ft.Column(
            [titulo, texto, imagen]
            + botones_opciones
            + [btn_comenzar, btn_reset],
            alignment=ft.MainAxisAlignment.START,
            horizontal_alignment=ft.CrossAxisAlignment.CENTER,
            spacing=16,
            expand=True
        )
    )

    on_reset(None)

ft.app(target=main)
